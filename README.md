# DevAssist4-2-0
# 1) Create project folder
rm -rf UstreamBot-iOS && mkdir UstreamBot-iOS && cd UstreamBot-iOS

# 2) Your SwiftUI entry point
cat > UstreamBotApp.swift << 'EOF'
import SwiftUI

@main
struct UstreamBotApp: App {
    var body: some Scene {
            WindowGroup {
                            ContentView()
            }
    }
}
EOF

# 3) Your ContentView (video + chat)
cat > ContentView.swift << 'EOF'
import SwiftUI
import AVKit

struct ContentView: View {
        @State private var messages: [ChatMessage] = [
                    ChatMessage(text: "Hello! I am UstreamBot. How can I assist you?", isUser: false)
        ]
            @State private var currentPrompt: String = ""
                let player = AVPlayer(url:
                      URL(string:
                              "http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
                )!
                    )
                    
                        var body: some View {
                                    NavigationView {
                                                    VStack {
                                                                        VideoPlayer(player: player)
                                                                                            .frame(height: 220)
                                                                                                                .onAppear {
                                                                                                                                            try? AVAudioSession.sharedInstance()
                                                                                                                                                                      .setCategory(.playback, mode: .moviePlayback)
                                                                                                                }
                                                                                                                                chatSection
                                                    }
                                                                .navigationTitle("UstreamBot")
                                                                            .navigationBarTitleDisplayMode(.inline)
                                    }
                        }

                            private var chatSection: some View {
                                        VStack {
                                                        ScrollView {
                                                                            VStack(alignment: .leading, spacing: 12) {
                                                                                                    ForEach(messages) { msg in
                                                                                                                            MessageView(message: msg)
                                                                                                    }
                                                                            }
                                                                                            .padding()
                                                        }
                                                                    HStack {
                                                                                        TextField("Ask UstreamBot...", text: $currentPrompt)
                                                                                                            .textFieldStyle(RoundedBorderTextFieldStyle())
                                                                                                                                .padding(.leading)
                                                                                                                                                Button(action: sendMessage) {
                                                                                                                                                                        Image(systemName: "arrow.up.circle.fill")
                                                                                                                                                                                                .font(.title)
                                                                                                                                                }
                                                                                                                                                                .padding(.trailing)
                                                                                                                                                                                .disabled(currentPrompt.isEmpty)
                                                                                                                                                                                            }
                                                                                                                                                                                                        .padding(.bottom, 8)
                                        }
                            }

                                private func sendMessage() {
                                            guard !currentPrompt.isEmpty else { return }
                                                    let prompt = currentPrompt
                                                            messages.append(.init(text: prompt, isUser: true))
                                                                    currentPrompt = ""
                                                                            APIClient.sendMessage(prompt: prompt) { result in
                                                                                        DispatchQueue.main.async {
                                                                                                        switch result {
                                                                                                                        case .success(let reply):
                                                                                                                                            messages.append(.init(text: reply, isUser: false))
                                                                                                                                                            case .failure:
                                                                                                                                                                                messages.append(.init(text: "❌ Error contacting backend", isUser: false))
                                                                                                                                                                                                }
                                                                                                                                                                                                            }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                        }
                                                                                                                                                                                                                        
                                                                                                                                                                                                                        struct ChatMessage: Identifiable {
                                                                                                                                                                                                                            let id = UUID(), text: String, isUser: Bool
                                                                                                                                                                                                                            }
                                                                                                                                                                                                                            
                                                                                                                                                                                                                            struct MessageView: View {
                                                                                                                                                                                                                                let message: ChatMessage
                                                                                                                                                                                                                                    var body: some View {
                                                                                                                                                                                                                                            HStack {
                                                                                                                                                                                                                                                        if message.isUser {
                                                                                                                                                                                                                                                                        Spacer()
                                                                                                                                                                                                                                                                                        Text(message.text)
                                                                                                                                                                                                                                                                                                          .padding(12)
                                                                                                                                                                                                                                                                                                                            .background(Color.blue)
                                                                                                                                                                                                                                                                                                                                              .foregroundColor(.white)
                                                                                                                                                                                                                                                                                                                                                                .cornerRadius(15)
                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                            Text(message.text)
                                                                                                                                                                                                                                                                                                                                                                                                              .padding(12)
                                                                                                                                                                                                                                                                                                                                                                                                                                .background(Color(UIColor.systemGray5))
                                                                                                                                                                                                                                                                                                                                                                                                                                                  .cornerRadius(15)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Spacer()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          # 4) API client pointing at your live Flask endpoint
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cat > APIClient.swift << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          import Foundation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          struct APIClient {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              static func sendMessage(prompt: String,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          completion: @escaping (Result<String, Error>) -> Void) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  guard let url = URL(string: "https://YOUR_BACKEND_URL/chat") else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              completion(.failure(NSError(domain:"Invalid URL", code:0)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          return
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          var req = URLRequest(url: url)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  req.httpMethod = "POST"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          req.addValue("application/json", forHTTPHeaderField: "Content-Type")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  req.httpBody = try? JSONSerialization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .data(withJSONObject: ["prompt":prompt], options: [])
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    URLSession.shared.dataTask(with: req) { data, _, err in
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if let e = err { return completion(.failure(e)) }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            guard let d = data,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              let json = try? JSONSerialization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  .jsonObject(with:d) as? [String:String],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    let resp = json["response"]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return completion(.failure(NSError(domain:"Bad response", code:1)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        completion(.success(resp))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }.resume()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # 5) Info.plist with PiP & network permissions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cat > Info.plist << 'EOF'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <?xml version="1.0" encoding="UTF-8"?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <plist version="1.0">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <dict>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <key>CFBundleName</key>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <string>UstreamBot</string>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <key>UIDeviceFamily</key>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <array><integer>1</integer><integer>2</integer></array>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <key>NSAppTransportSecurity</key>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <dict>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <key>NSAllowsArbitraryLoads</key><true/>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </dict>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <key>NSCameraUsageDescription</key>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <string>Needed for future camera features</string>Scinc<esiretairat )tErrAFd_t.lata bret piu a —ikt- .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            o is0  tiSermz}
                                }
                                                                                                                                                }
                                                                    }}
                                                                            }
                                                        }
                                        }
                            }
                                                                                                                }
                                                    }
                                    }
                        }))
        ]
}>>
            }
<!-- Trigger build for TestFlight -->